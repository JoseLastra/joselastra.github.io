---
title: "Unidad 2: Funciones auxiliares - <br>Operaciones en el server<br>"
subtitle: "Curso: Análisis espacial, web-mapping y <br>aplicaciones web con R Shiny<br>"
author: "Mg. José A. Lastra"
institute: "Laboratorio Geo-Información y Percepción Remota"
date: "`r format(Sys.time(), '%d/%m/%Y')`"
output:
  xaringan::moon_reader:
    css: [fc]
    lib_dir: libs
    nature:
      highlightStyle: github
      ratio: '16:9'
      highlightLines: true
      countIncrementalSlides: false
      beforeInit: "macros.js"

---
background-image: url(logo_labgrs_color.png)
background-position: center
background-size:40%

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
library(shiny)
library(leaflet)
library(tidyverse)
library(sf)
library(shinybusy)
```


---

Librerías utilizadas en esta sesión

```{r eval=F}
library(shiny)
library(leaflet)
library(tidyverse)
library(sf)
library(shinybusy)
```


---
class: inverse, center, middle

# INTRODUCCIÓN

---
#Creando funciones

--
- La creación de una función específica es útil para limpiar el código dentro de nuestra aplicación (siempre que se pueda)

--

> To understand computations in R, two slogans are helpful:
- Everything that exists is an object, and
- Everything that happens is a function call.

.footnote[John Chambers creador de R, en Advanced R (2019) 2da Edición, p. 79.]

---
#Creando una aplicación simple

--
- Usando información de faenas mineras de Chile de nombre *FaenasMineras.shp* obtenida desde [SINIA, MMA](https://ide.mma.gob.cl/), crearemos una app donde usaremos:

--
- Código *HTML* y *CSS* empleando la función *tag()*

--
- Funciones y conductores reactivos (reactive, eventReactive, observers, etc.)

--
- Crearemos una función auxiliar y la emplearemos dentro del código.

---
#UI base

--
```{r eval=F}
library(shiny)
library(leaflet)
library(tidyverse)
library(sf)
library(shinybusy)

ui <- bootstrapPage(
  tags$style(type = "text/css", "html, body {width:100%;height:100%}"), #esto hace la magia
  leafletOutput('map', width = "100%", height = "100%"),
  )
)
```

---
#Server base

--
```{r eval=F}
server <- function(input, output, session) {
  #Load data
  shp <- read_sf('data/data/viña_del_mar.shp') %>% st_transform(4326)
  ## rendering base map
  output$map <- renderLeaflet({
    leaflet() %>% addProviderTiles(providers$CartoDB.DarkMatter) %>% 
      addCircleMarkers(data = shp,group = 'Plantaciones') %>%
      addLayersControl(overlayGroups = 'Plantaciones',position = 'topleft')
  })
}
```

---
class: middle, center
![:scale 65%](app1.png)

---
#Añadiendo opciones

--
- Agregaremos un panel donde pondremos nuestras opciones

--
- Importante conocer esto sobre los paneles y su posición [Más info.](https://leafletjs.com/reference-1.7.1.html#map-pane)
--
-
```{r, eval=F}
absolutePanel(id="controls",
                style="z-index:500;", top = 90, left = "auto", right = 20, 
                bottom = "auto",
                width = 400, height ="auto",
                class = "panel panel-default",
                selectInput(inputId = 'resumen',label = 'Seleccione nivel para resumen',
                            choices = c(1,2,3)),
                actionButton('remap',label = 'Mostrar información seleccionada')
  )
```


---
class: inverse,center, middle

# ¿PREGUNTAS?

---

class: inverse,center, middle

# PRÓXIMA SEMANA SEGUIMOS <br> CONDUCTORES REACTIVOS <br> 

