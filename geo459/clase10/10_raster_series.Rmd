---
title: "Unidad 2: Eventos reactivos: Raster y series - <br>Operaciones en el server<br>"
subtitle: "Curso: Análisis espacial, web-mapping y <br>aplicaciones web con R Shiny<br>"
author: "Mg. José A. Lastra"
institute: "Laboratorio Geo-Información y Percepción Remota"
date: "`r format(Sys.time(), '%d/%m/%Y')`"
output:
  xaringan::moon_reader:
    css: [fc]
    lib_dir: libs
    nature:
      highlightStyle: github
      ratio: '16:9'
      highlightLines: true
      countIncrementalSlides: false
      beforeInit: "macros.js"

---
background-image: url(logo_labgrs_color.png)
background-position: center
background-size:40%

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
library(shiny)
library(leaflet)
library(tidyverse)
library(sf)
library(raster)
library(dygraphs)
library(shinybusy)
library(shinythemes)
```


---

Librerías utilizadas en esta sesión

```{r eval=F}
library(shiny)
library(leaflet)
library(tidyverse)
library(sf)
library(raster)
library(dygraphs)
library(shinybusy)
library(shinythemes)
```


---
class: inverse, center, middle

# INTRODUCCIÓN

---
# Summary

--
- Hasta el momento hemos visto como estructurar aplicaciones

--
- Hemos creado y empleado funciones

--
- Hemos empleado widgets y elementos reactivos

--
- Hemos visto algunas configuraciones de páginas


---
#Metas de hoy

--
- Hoy realizaremos una nueva aplicación donde usaremos reacciones de mapa sobre elementos raster

--
- Además veremos como insertar imágenes (útil para logos)

--
- Veremos como graficar series de tiempo

--
- Añadiremos procesamiento como función.

--
.center[
![:scale 60%](https://raw.githubusercontent.com/allisonhorst/stats-illustrations/master/other-stats-artwork/debugging.jpg)
]
.center[.footnote[© Allison Horst]]

---
#UI

--
- Configuraremos un tipo de app con pestañas.

--
```{r eval=F}
ui <- navbarPage(title = 'RasterSeries',id = 'nav',theme = shinytheme("spacelab"), # App theme 
                 tabPanel('Mapa principal', # Main page view
                          leafletOutput("map", width = "100%", height = 600), # Main map
                          # Option panel
                          absolutePanel(id = "controls", class = "panel panel-default", fixed = F,
                                        draggable = F, top = 90, left = "auto", right = 20, bottom = "auto",
                                        width = 300, height ="auto",
                                        style="z-index:500;"),
                          absolutePanel(top = 85,left = 80,right = 'auto',width = 200,
                                        height = 200,bottom = 'auto',fixed = T,style="z-index:500")
                 ),
                 #Description
                 tabPanel('Tab secundario',
                          sidebarLayout(sidebarPanel(),
                            mainPanel())
                          )
)
```

---
#Server

--
- Nuestro server deberá de momento estar vacío.

--
```{r eval=F}
server <- function(input, output, session) {
  
}

shinyApp(ui, server)
```

---
# ¿Qué queremos en nuestras pestañas?

--
*Primera:*

--
- Un mapa dinámico

--
- Visualización de rasters con opción de seleccionad la fecha

--
- Serie de tiempo a través de un click

--
- Gráfico de serie de tiempo dinámico


--
*Segunda*

--
- Tabla con la información de temperatura por pixel

---
#Agregando opciones

--
- Agregaremos un *dateInput()* en el primer panel absoluto para la selección de fechas

--
```{r eval=F}
# Option panel
absolutePanel(id = "controls", class = "panel panel-default", fixed = F,
              draggable = F, top = 90, left = "auto", right = 20, bottom = "auto",
              width = 300, height ="auto",
              style="z-index:500;", ## html
              dateInput("date", label = 'Seleccione fecha', value = "2014-01-01",
                        min = '2010-01-01',max = '2020-01-01'))
```

--
- Crearemos en el server nuestro mapa base

--
```{r eval= F}
#basemap
  output$map <- renderLeaflet({
    leaflet() %>% addProviderTiles(providers$Esri.WorldImagery) 
  })
```

---
class: center, middle
![:scale 70%](app1.png)

---
#Insertando una imagen (logo)

--
- Para que shiny reconozca las imágenes que deseamos emplear, crearemos una carpeta de nombre *www* en el directorio de la aplicación.

--
- Ahí pegaremos pegaremos la imagen de nombre *logo_labgrs.png*

--
- Para agregar imágenes podemos emplear la función *img()*. La pondremos en el segundo panel absoluto

--
```{r eval=F}
absolutePanel(top = 85,left = 80,right = 'auto',width = 200,
              height = 200,bottom = 'auto',fixed = T,style="z-index:500",
              img(src='logo_labgrs.png',width=250,height=100)
             )
```

---
class: center, middle
![:scale 70%](app2.png)

---
#Otra alternativa

--
- Uso de HTML

--
```{r eval=F}
 absolutePanel(top = 85,left = 80,right = 'auto',width = 200,
               height = 200,bottom = 'auto',fixed = T,style="z-index:500",
               HTML('<img height="90"  src="logo_labgrs.png" asp="1" align="left">')
               )
```

---
class: middle, center
![:scale 70%](app3.png)

---
#Ahora cargaremos los datos en nuestro server
---
class: inverse,center, middle

# ¿PREGUNTAS?


---

class: inverse,center, middle

# PRÓXIMA SEMANA SEGUIMOS <br> MEJORANDO NUESTRA APP <br> 

