---
title: "Ayuda memoria [Datos]"
subtitle: "Curso: Análisis espacial, web-mapping y <br>aplicaciones web con R Shiny<br>"
author: "Mg. José A. Lastra"
institute: "Laboratorio Geo-Información y Percepción Remota"
date: "`r format(Sys.time(), '%d/%m/%Y')`"
output:
  xaringan::moon_reader:
    css: [fc]
    lib_dir: libs
    nature:
      highlightStyle: github
      ratio: '16:9'
      highlightLines: true
      countIncrementalSlides: false
      beforeInit: "macros.js"

---
background-image: url(logo_labgrs_color.png)
background-position: center
background-size:40%

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
library(tidyverse)
library(corrplot)
library(readxl)
library(npphen)
library(TTR)
library(scales)
library(ggplot2)
library(tidyquant)
library(dplyr)
library(DT)

```


---

Librerías utilizadas en esta sesión

```{r eval=F}
library(tidyverse)
library(readxl)
library(TTR)
library(scales)

```

Estas permiten la lectura, manipulación básica y avanzada de datos. Además de la construcción de gráficos y figuras.
---
class: inverse, center, middle

# Lectura de datos alfanuméricos

---

--
En R podemos leer muchos tipos de datos (tablas, bases de datos, shapefiles, imágenes, etc.)

--

```{r ,eval=T, echo=T, error=FALSE,warning=FALSE,message=FALSE}

#read data frames
CTD <- read_excel("Araucania2018_CTD_C1.xls")
```

```{r echo=F}
CTD %>% 
  datatable(class = 'cell-border stripe',rownames = FALSE,options = list(pageLength = 3))
```

---
# Seleccionando datos dentro de nuestro data frame

--
# Columnas

- Seleccionar datos puede ser bastante flexible y dependerá de lo que nos resulte más cómodo o más eficiente.
--
```{r  echo=T,eval=T}
#Forma 1
CTD.sub <- CTD[,6:9] %>% as.data.frame()

```

```{r echo=F}
CTD.sub %>% 
  datatable(class = 'cell-border stripe',rownames = FALSE,options = list(pageLength = 5))
```
---

```{r  echo=T,eval=T}
#Forma 2
columnas <- colnames(CTD)[6:9]
CTD.sub <- CTD[,columnas] %>% as.data.frame()

```
--
```{r echo=F}
CTD.sub %>% 
  datatable(class = 'cell-border stripe',rownames = FALSE,options = list(pageLength = 5))
```

---

```{r  echo=T,eval=T}
#Forma 3
CTD.sub <- CTD %>% dplyr::select(`Temperatura (°C)`, `Sigma T (Kg/m3)`, `Salinidad (UPS)`,`Oxigeno (ml/L)`)

```
--
```{r echo=F}
CTD.sub %>% 
  datatable(class = 'cell-border stripe',rownames = FALSE,options = list(pageLength = 5))
```
---

# Filas

--
-La selección de filas también puede ser realizada de varias maneras
--
```{r eval=T}
##seleccionando 50 registros
CTD_50 <- CTD[1:50,]
```

```{r echo=F}
CTD_50 %>% 
  datatable(class = 'cell-border stripe',rownames = FALSE,options = list(pageLength = 3))
```

---
--
```{r eval=T}
##seleccionando registros según condiciones
CTD_nehuentue2 <- CTD %>% filter(Estaciones=='Nehuentué2')
```

--
```{r echo=F}
CTD_nehuentue2 %>% 
  datatable(class = 'cell-border stripe',rownames = FALSE,options = list(pageLength = 3))
```

---
#¿Y si quiero las estaciones a 2, 5 y 10 millas?

--
```{r eval=T}
##seleccionando registros 
estaciones <- unique(CTD$Estaciones)[1:3]
CTD_nehuentue <- CTD %>% filter(Estaciones %in% estaciones)
```

--
```{r echo=F}
CTD_nehuentue %>% 
  datatable(class = 'cell-border stripe',rownames = FALSE,options = list(pageLength = 3))
```
---
class: inverse, center, middle

# Lectura de datos alfanuméricos

---

--
```{r , warning=F,error=F,message=F}
#leyendo los datos
cimar <- read_excel('cimarfiordos20.xls')

```
--
```{r warning=F,error=F,message=F, echo=F}

head(cimar) %>%
  datatable(class = 'cell-border stripe',extensions = 'FixedColumns',rownames = FALSE,
            options = list(pageLength = 5,dom = 't', scrollX = TRUE,fixedColumns = TRUE))
```

---

--

```{r warning=F,error=F,message=F,fig.width=3.5,fig.retina=2,fig.align='center'}
#filtrar datos
estacion <- cimar %>% filter(ESTACIÓN == 2) %>% as.data.frame()
#grafiquemos la información
plot(x = estacion$`TEMPERATURA (°C)`,y = estacion$`PROFUNDIDAD (m)`*-1, 
     type='l',xlab='Temp (°C)', ylab='Depth (m)')

```

---
#Series de tiempo

```{r warning=F,message=F,error=F}
ts.data <- read.csv('Iquique_TS.csv')
```

```{r echo=F}
ts.data %>% 
  datatable(class = 'cell-border stripe',rownames = FALSE,options = list(pageLength = 4))
```

---
class: middle
```{r echo=T, fig.retina=2, fig.align='center',fig.width=15,fig.height=3}
ggplot(data = ts.data,aes(x=as.Date(fechas),y=sst)) + geom_line(lwd=0.5) +  
  xlab('') + ylab('SST (°C)') + theme_bw()
```

---

Más manipulación de datos
--
```{r}
#creando objeto time-series
ts.iquique <- ts(ts.data[,3],start = c(1981,9),frequency = 365)

```

--
```{r}
#objeto con descomposición
ts.decompose <- ts.iquique %>% decompose()
```
--
```{r}
#creando objeto fechas
fechas <- as.Date(ts.data$fechas, format='%Y-%m-%d')

#creando minitablas para graficar
serie <- data.frame(sst=ts.decompose$x, categoria='Serie original', fechas=fechas)
tendencia <- data.frame(sst=ts.decompose$trend, categoria='tendencia', fechas=fechas)
```
--
```{r}
#peguemos los datos
serie.ts<-list(serie, tendencia) %>% reduce(bind_rows)
```

---
class: middle
```{r fig.retina=2, fig.align='center',fig.width=15,fig.height=3, warning=F}
#grafiquemos
ggplot(data = serie.ts,aes(x=fechas, y= sst, color=categoria)) + 
  geom_line() + xlab('') + ylab('SST (°C)') + 
  scale_x_date(labels=date_format("%Y"), breaks=date_breaks(width="2 year"), 
               limits=c(as.Date('1981-8-1'), as.Date('2019-4-30'))) + theme_bw()

```
---

class: inverse,center, middle

# ¿PREGUNTAS?

---

class: inverse,center, middle

# PÓXIMA SEMANA REPASO GEODATOS!

