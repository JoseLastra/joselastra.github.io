---
title: "Mini-Taller"
subtitle: "Introducción al análisis de datos con R"
author: "Mg. José A. Lastra"
institute: "Laboratorio Geo-Información y Percepción Remota"
date: "`r format(Sys.time(), '%d/%m/%Y')`"
output:
  xaringan::moon_reader:
    css: [fc]
    lib_dir: libs
    nature:
      highlightStyle: github
      ratio: '16:9'
      highlightLines: true
      countIncrementalSlides: false
      beforeInit: "macros.js"
      
---

background-image: url(logo_labgrs_color.png)
background-position: center
background-size:50%

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
library(corrplot)
library(readxl)
library(npphen)
library(TTR)
library(scales)
library(ggplot2)
library(tidyquant)
library(dplyr)
library(DT)

```

---
class: inverse, center, middle

# INTRODUCCIÓN

---
#Lectura básica de datos

```{r ,eval=T, echo=T, error=FALSE,warning=FALSE,message=FALSE}

#read data frames
CTD <- read_excel("Araucania2018_CTD_C1.xls")
```


```{r echo=F}
CTD %>% 
  datatable(class = 'cell-border stripe',rownames = FALSE,options = list(pageLength = 5))
```

---
# Seleccionando datos dentro de nuestro data frame
# Columnas

- Seleccionar datos puede ser bastante flexible y dependerá de lo que nos resulte más cómodo o más eficiente.
--
```{r  echo=T,eval=T}
#Forma 1
CTD.sub <- as.data.frame(CTD[,6:9])

```

```{r echo=F}
CTD.sub %>% 
  datatable(class = 'cell-border stripe',rownames = FALSE,options = list(pageLength = 5))
```
---

```{r  echo=T,eval=T}
#Forma 2
columnas <- colnames(CTD)[6:9]
CTD.sub <- as.data.frame(CTD[,columnas])

```
--
```{r echo=F}
CTD.sub %>% 
  datatable(class = 'cell-border stripe',rownames = FALSE,options = list(pageLength = 5))
```

---

```{r  echo=T,eval=T}
#Forma 3
CTD.sub <- CTD %>% select(`Temperatura (°C)`, `Sigma T (Kg/m3)`, `Salinidad (UPS)`,`Oxigeno (ml/L)`)

```
--
```{r echo=F}
CTD.sub %>% 
  datatable(class = 'cell-border stripe',rownames = FALSE,options = list(pageLength = 5))
```
---

# Filas

--
-La selección de filas también puede ser realizada de varias maneras
--
```{r eval=T}
##seleccionando 50 registros
CTD_50 <- CTD[1:50,]
```

```{r echo=F}
CTD_50 %>% 
  datatable(class = 'cell-border stripe',rownames = FALSE,options = list(pageLength = 3))
```

---
```{r eval=T}
##seleccionando registros según condiciones
CTD_nehuentue2 <- filter(CTD, Estaciones=='Nehuentué2')

##este código es lo mismo, pero usa tidyverse
CTD_nehuentue2 <- CTD %>% filter(Estaciones=='Nehuentué2')
```

```{r echo=F}
CTD_nehuentue2 %>% 
  datatable(class = 'cell-border stripe',rownames = FALSE,options = list(pageLength = 3))
```

---
#¿Y si quiero las estaciones a 2, 5 y 10 millas?

```{r eval=T}
##seleccionando registros 
estaciones <- unique(CTD$Estaciones)[1:3]
CTD_nehuentue <- filter(CTD, Estaciones %in% estaciones)

#esto es lo mismo
CTD_nehuentue <- CTD %>% filter(Estaciones %in% estaciones)
```

--
```{r echo=F}
CTD_nehuentue %>% 
  datatable(class = 'cell-border stripe',rownames = FALSE,options = list(pageLength = 3))
```
---
class: inverse, center, middle

# Jugando con el laboratorio 2
---

```{r eval=T,echo=F,fig.retina=T,warning=F,message=F,error=F,out.width='100%'}
library(sf)
library(leaflet)

shp<-read_sf('cimar_20_dots.shp') %>% as_Spatial()

leaflet(shp) %>% addProviderTiles('Esri.WorldImagery')%>% 
 addProviderTiles("TomTom.Labels") %>%
  addCircles(popup = ~ESTACIÃ.e2..U.0080.,radius = ~DENSIDAD..*4,color = 'red')

```

---
# Correlación

--
-El análisis simple de correlación nos permite identificar posibles relaciones (lineales) entre diferentes variables

--
```{r , warning=F,error=F,message=F}
#leyendo los datos
cimar<-read_xls('cimarfiordos20.xls')

```

```{r warning=F,error=F,message=F, echo=F}

head(cimar) %>%
  datatable(class = 'cell-border stripe',extensions = 'FixedColumns',rownames = FALSE,
            options = list(pageLength = 5,dom = 't', scrollX = TRUE,fixedColumns = TRUE))
```

---
```{r warning=F,error=F,message=F}
#filtrar datos
estacion<-as.data.frame(filter(cimar, ESTACIÓN == 2))
#esto es lo mismo
estacion<-cimar %>% filter(ESTACIÓN == 2) %>% as.data.frame()

```

```{r warning=F,error=F,message=F, echo=F}

head(estacion) %>%
  datatable(class = 'cell-border stripe',extensions = 'FixedColumns',rownames = FALSE,
            options = list(pageLength = 3,dom = 't', scrollX = TRUE,fixedColumns = TRUE))
```

Exploremos un poco nuestros datos:
- Podemos usar *summary()*, *head()* o graficar los datos con *plot()* o usar *ggplot()*

---

```{r warning=F,error=F,message=F,fig.width=3.5,fig.retina=2,fig.align='center'}
#grafiquemos la información
plot(x = estacion$`TEMPERATURA (°C)`,y = estacion$`PROFUNDIDAD (m)`*-1, type='l',xlab='Temp (°C)',
     ylab='Depth (m)',bg='transparent')

```

---

```{r}
#columnas de interés
estacion.cor<-estacion[,c(9:11)]
#matriz numérica
est.num <- cor(estacion.cor)
```
--
Si vemos la matriz de correlación
```{r warning=F,error=F,message=F, echo=F}

est.num %>% as.data.frame() %>% knitr::kable() %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover",full_width = F))
```


Con estos datos ya se puede realizar un análisis, pero siempre es bueno recurrir al uso de gráficos para transmitir de manera más clara la información.

---

```{r fig.retina=2,fig.align='center'}
#calculando significancia
p <- cor.mtest (est.num, conf.level = .95)
#graficando correlaciones significativas
corrplot(est.num,method ="number", type="upper",sig.level = 0.05,
         p.mat =p$p,insig = "blank")#correlation matrix
```

---
class: inverse, center, middle

#Cambiemos datos
---
Consideremos una estación con influencia glaciar y el mismo nivel de significancia

```{r warning=F,error=F,message=F}
#estación interior
estacion <- cimar %>% filter(ESTACIÓN == 19) %>% as.data.frame()

```

```{r fig.retina=2,fig.align='center', echo=F}
#columnas de interés
estacion.cor<-estacion[,c(9:11)]
#matriz numérica
est.num <- cor(estacion.cor)
#calculando significancia
p <- cor.mtest (est.num, conf.level = .95)
#graficando correlaciones significativas
corrplot(est.num,method ="number", type="upper",sig.level = 0.05,
         p.mat =p$p,insig = "blank")#correlation matrix
```
---
#¿Cambia según profundidad?
--
```{r}
P020 <- estacion %>% filter(`PROFUNDIDAD (m)` <= 20) %>% as.data.frame()
P20 <- estacion %>% filter(`PROFUNDIDAD (m)` > 20) %>% as.data.frame()
```

---

class: center, middle

# GRACIAS POR SU ATENCIÓN

.center[![:scale 50%](logo_labgrs_color.png)]
---

class: inverse,center, middle





