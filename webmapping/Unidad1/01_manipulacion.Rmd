---
title: "Lectura y visualización básica de datos en RStudio"
subtitle: "Curso: Introducción al análisis espacial y web-mapping <br>con Google Earth Engine y R Shiny<br>"
author: "Mg. José A. Lastra <br>Matías Olea<br>"
institute: "Laboratorio Geo-Información y Percepción Remota"
date: "`r format(Sys.time(), '%d/%m/%Y')`"
output:
  xaringan::moon_reader:
    css: [fc]
    lib_dir: libs
    nature:
      highlightStyle: zenburn
      ratio: '16:9'
      highlightLines: true
      countIncrementalSlides: false
      beforeInit: "macros.js"

---
background-image: url(logo_labgrs_color.png)
background-position: center
background-size:40%

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
library(tidyverse)
library(readxl)
library(DT)

```


---
class: middle,center
<iframe width="95%" height="95%" src="https://www.youtube.com/embed/aFkWYcD0RmM" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
---
Librerías utilizadas en esta sesión

```{r eval=F}
library(tidyverse)
library(readxl)
```

--
- Con estas librerías podremos leer, manipular, modificar y realizar análisis sobre matrices, vectores y data frames con información alfanumérica dentro de R.

--
- Entender al menos las funciones básicas de lectura y manipulación de información es escencial para luego pasar de la codificación en R a la sintáxis de shiny.

---
# Lectura de datos alfanuméricos

--
- En R, podemos crear diferentes objetos y almacenar en ellos valores de distinto tipo (números, caracteres, matrices, etc.)

--
- Estos valores pueden ser creados dentro de R o pueden ser leídos desde distintas fuentes de archivo.

--
- A medida que vayamos avanzando ,veremos las diferentes estructuras que puede tener un objeto en R considerando la fuente de datos que utilicemos y la función de lectura empleada.

---
# Lectura de archivos excel

--
```{r ,eval=T, echo=T, error=FALSE,warning=FALSE,message=FALSE}

## Leer archivo
CTD <- read_excel("Araucania2018_CTD_C1.xls")
```

--
- Otras funciones de lectura son:
  + read.csv(base R) ó read_csv(tidyverse)
  + readRDS(base R)
  + read.table(base R)

--
- *Importante*: siempre debe revisar el directorio de trabajo donde se encuentra y asegurarse de que el archivo se encuentre en ese directorio.

```{r echo=F, eval=T}
CTD %>% 
  datatable(class = 'cell-border stripe',rownames = FALSE,options = list(pageLength = 3))
```

---
# Revisando la estructura

--
- Un aspecto importante es poder ver algunas características de nuestra información, para lo cual disponemos de algunas funciones como:

--
- Para revisar primeros registros
```{r}
head(CTD)
```

---
- Para revisar los últimos
```{r}
tail(CTD)
```

--- 
- Podemos revisar la clase de objeto

```{r}
class(CTD)
```

---
- La estructura
```{r}
str(CTD)
```

---
# Uso de funciones

--
- En R muchas veces emplearemos diferentes funciones sobre un mismo objeto.

--
- Por esto es importante entender el concepto de anidar funciones y como R las lee.

--
- En una forma convencional R lee el código desde dentro hacia afuera, como se puede ver en este ejemplo:

```{r}
## creando números aleatorios y calculando el mínimo
min(rnorm(n = 100,mean = 10,sd = 4))
```

--
- Lo primero en ejecutarse es la función *rnorm()* y luego la función *min()*

---

- Al usar *tidyverse* podemos valernos de `%>%` para usar funciones consecutivas y leer de izquierda a derecha

--
- Esto es útil porque hace que nuestro código en general sea más ordenado y encontrar errores también sea más simple.

--
- Mismo ejemplo:


```{r echo=T}
rnorm(n = 100, mean = 10, sd = 4) %>%
min() 
```

--
- *El resultado no es el mismo porque usamos números aleatorios sin configurar una semilla con la función `set.seed()`*

---
# Seleccionando datos dentro de nuestro data frame

--
# Columnas

- Seleccionar datos puede ser bastante flexible y dependerá de lo que nos resulte más cómodo o más eficiente.
--
```{r  echo=T,eval=T}
#Forma 1
CTD.sub <- CTD[,6:9] %>% as.data.frame()
#esto es lo mismo
CTD.sub <- as.data.frame(CTD[,6:9])
```

```{r echo=F}
CTD.sub %>% 
  datatable(class = 'cell-border stripe',rownames = FALSE,options = list(pageLength = 3))
```
---

--
- Aquí podemos crear un objeto con las columnas de interés y luego usarlo para seleccionarlas en nuestra tabla.

```{r  echo=T,eval=T}
#Forma 2
columnas <- colnames(CTD)[6:9] #creando objeto para seleccionar columnas
CTD.sub <- CTD[,columnas] %>% as.data.frame()

#esto es lo mismo
CTD.sub <- as.data.frame(CTD[,columnas])

```
--
```{r echo=F}
CTD.sub %>% 
  datatable(class = 'cell-border stripe',rownames = FALSE,options = list(pageLength = 3))
```

---

--
- Aquí se emplea una función de la librería *dplyr*, que se carga cuando empleamos *tidyverse* y nos permite usar otras herramientas de manipulación de datos.

```{r  echo=T,eval=T}
#Forma 3
CTD.sub <- CTD %>% dplyr::select(`Temperatura (°C)`, `Sigma T (Kg/m3)`, `Salinidad (UPS)`,`Oxigeno (ml/L)`)
#esto es lo mismo
CTD.sub <- dplyr::select(CTD, `Temperatura (°C)`, `Sigma T (Kg/m3)`, `Salinidad (UPS)`,`Oxigeno (ml/L)`)
```
--
```{r echo=F}
CTD.sub %>% 
  datatable(class = 'cell-border stripe',rownames = FALSE,options = list(pageLength = 3))
```
---

# Filas

--
-La selección de filas también puede ser realizada de varias maneras
--
```{r eval=T}
##seleccionando 50 registros
CTD_50 <- CTD[1:50,]
```

```{r echo=F}
CTD_50 %>% 
  datatable(class = 'cell-border stripe',rownames = FALSE,options = list(pageLength = 3))
```

---
--
```{r eval=T}
##seleccionando registros según condiciones
CTD_nehuentue2 <- CTD %>% filter(Estaciones=='Nehuentué2')

#esto es lo mismo
CTD_nehuentue2 <- filter(CTD, Estaciones=='Nehuentué2')
```

--
```{r echo=F}
CTD_nehuentue2 %>% 
  datatable(class = 'cell-border stripe',rownames = FALSE,options = list(pageLength = 3))
```

---
#¿Y si quiero las estaciones a 2, 5 y 10 millas?

--
- Podemos emplear diferentes formas de establecer valores para filtrar nuestra información

--
- Lo irmpotante es asegurarse que el valor esté dentro de la tabla (si es numérico) o escribirlo igual a como aparece en la tabla (si es caracter)

--
- En este ejemplo se usa la función *unique()* para identificar los elementos únicos dentro de la coumna *Estaciones* y se seleccionan los primeros tres empleando los *[ ]*

--
```{r}
#solo para ver resultado
unique(CTD$Estaciones)[1:3]
```

---

--
```{r eval=T}
##seleccionando registros 
estaciones <- unique(CTD$Estaciones)[1:3] #creando bjeto con valores de interes
CTD_nehuentue <- CTD %>% filter(Estaciones %in% estaciones)
#esto es lo mismo 
CTD_nehuentue <- filter(CTD, Estaciones %in% estaciones)
```

--
```{r echo=F}
CTD_nehuentue %>% 
  datatable(class = 'cell-border stripe',rownames = FALSE,options = list(pageLength = 3))
```

---
#Graficando en R

--
- En R podemos realizar todo tipo de análisis y además podemos obtener resultados gráficos de los mismos y de los datos de origen.

--
- La función base de R para realizar gráficos es *plot()* y dispone de diferentes parámetros configurables [[Más detalles.](https://www.statmethods.net/advgraphs/parameters.html)]

--
- Un ejemplo

```{r eval = F,warning=F,error=F,message=F,fig.width=3.5,fig.retina=2,fig.align='center'}
 ctd_filter <- CTD %>% filter(Estaciones == 'Nehuentué2') #filtrando

#Graficando
plot(ctd_filter$`Temperatura (°C)`,ctd_filter$`Profundidad (m)`*-1, type = 'l', 
     xlab='Temperatura',ylab = 'Profundidad', main='Perfil de temperatura Nehuentué 2 millas')
```

---
```{r echo=F,eval = T,warning=F,error=F,message=F,fig.width=3.5,fig.retina=2,fig.align='center'}
 ctd_filter <- CTD %>% filter(Estaciones == 'Nehuentué2') #filtrando

#Graficando
plot(ctd_filter$`Temperatura (°C)`,ctd_filter$`Profundidad (m)`*-1, type = 'l', 
     xlab='Temperatura',ylab = 'Profundidad', main='Perfil de temperatura Nehuentué 2 millas')
```

---

--
- También podemos construir otro tipo de gráficos como boxplot o histogramas con las funciones base

--
```{r echo=T,eval = T,warning=F,error=F,message=F,fig.width=6,fig.retina=2,fig.align='center'}
#histograma
hist(ctd_filter$`Temperatura (°C)`, xlab='Temperatura', 
     main='Histograma de temperatura Nehuentué 2 millas')
```

---
```{r echo=T,eval = T,warning=F,error=F,message=F,fig.width=5,fig.retina=2,fig.align='center'}
#histograma
boxplot(ctd_filter$`Temperatura (°C)`, ylab='Temperatura', 
     main='Histograma de temperatura Nehuentué 2 millas')
```

---
# ggplot2

--
- Además de poder realizar la mayoría de los gráficos usando las funciones base de R, existen diferentes librerías gráficas que permiten llevar más allá la calidad de las figuras.

--
- Una de las más conocidas es *ggplot2*[[Más información](https://ggplot2.tidyverse.org/)], que se carga en nuestro entorno de trabajo al cargar *tidyverse*

--
- Un código base ejemplo consiste en:
  + Indicar la tabla (data frame) -> *data = mtcars*
  + Indicar qué graficaremos, lo normal es indicar un *x* e *y* -> *aes(x = mpg,y = wt)*

```{r eval=T,warning=F,error=F,message=F,fig.width=4,fig.height=3,fig.retina=2,fig.align='center'}
## basic plot
##usando datos propios de R
ggplot(data = mtcars, aes(x = mpg,y = wt))
```

--
- Esto solo crea el crea un lienzo para disponer del gráfico

--
- Además debemos indicar como queremos que la información se visualice (líneas, puntos, etc.)

---

--
- *Importante*: veremos muchas más alternativas más adelante, pero un buen ugar para indagar es el siguiente [sitio](https://www.r-graph-gallery.com/)

```{r eval=T,warning=F,error=F,message=F,fig.width=5,fig.height=5,fig.retina=2,fig.align='center'}
## basic plot
##usando datos propios de R
ggplot(data = mtcars, aes(x = mpg,y = wt)) +
  geom_point()
```


---
background-image: url(logo_labgrs_color.png)
background-position: center
background-size:40%



