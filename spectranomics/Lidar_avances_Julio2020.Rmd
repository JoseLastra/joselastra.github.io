---
title: "Spectranomics"
subtitle: "Avance LiDAR con 'lidR'"
author: "José A. Lastra"
institute: "Laboratorio Geo-Información y Percepción Remota"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: [fc,fc-fonts]
    lib_dir: libs
    nature:
      highlightStyle: github
      ratio: '16:9'
      highlightLines: true
      countIncrementalSlides: false
      
---

background-image: url(logo_labgrs_color.png)
background-position: center
background-size:contain

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
```

---
class: inverse, center, middle

# INTRODUCCIÓN

---
#Área de prueba

```{r eval=require('leaflet'), echo=F, error=FALSE, out.width='100%',warning=FALSE,message=FALSE}
library(leaflet)
library(tidyverse)
library(sf)
shp<-read_sf('extent_lidar.shp') 
predios<-read_sf('PREDIOS_Hiperespectral.shp')
shp<-st_transform(shp,'+proj=longlat +datum=WGS84 +no_defs ') %>% as_Spatial()
predios<-st_transform(predios,'+proj=longlat +datum=WGS84 +no_defs ') %>% as_Spatial()

leaflet()%>% addTiles()%>% 
  addPolygons(data = predios,color = 'blue', weight = 1, popup = ~NOMBRE,smoothFactor = 0.5,
    opacity = 0.5, fillOpacity = 0.5,highlightOptions = highlightOptions(color = "white", weight = 1,
      bringToFront = TRUE)) %>% addProviderTiles("CartoDB.PositronOnlyLabels") %>% 
  addPolygons(data = shp,color = 'yellow', weight = 1, smoothFactor = 0.5,
    opacity = 1.0, fillOpacity = 0.8,highlightOptions = highlightOptions(color = "white", weight = 2,
      bringToFront = TRUE)) %>% addProviderTiles("CartoDB.PositronOnlyLabels")

```

- Área: 1.08 km²
- Densidad: 40.8 points/m²
---
# LiDAR usando R

- Uso de paquete lidR: Roussel, J. R., Auty, D., DeFlorian, B., & Meador, A. S. (2020). *lidR: Airborne LiDAR Data Manipulation and Visualization for Forestry Applications*, version 3.0.2, acceso: 05 de Julio 2020, Recuperado de: [CRAN](https://CRAN.R-project.org/package=lidR)

```{r out.width='100%',  fig.height=2, eval=require('DiagrammeR'), echo=F,eval=T}
library(DiagrammeR)
grViz("digraph {

graph [layout = dot, rankdir = LR]

# define the global styles of the nodes. We can override these in box if we wish
node [shape = rectangle, style = filled, fillcolor = Linen]

data1 [label = 'LAS files', shape = folder, fillcolor = Beige]
process1 [label =  'Clasificación \n de puntos']
process2 [label = 'Generación \n DTM']
process3 [label =  'Normalización \n de nube de puntos']
process4 [label = 'Canopy Height Model \n (CHM)']
process5 [label = 'Segmentación']
results [label= 'Resultados']

# edge definitions with the node IDs
{data1}  -> process1 -> process2 -> process3 -> process4 -> process5 -> results
}")
```

--
##Aspectos críticos
- Tiempo de procesamiento;
- Clasificación de puntos;
- Generación de un buen DTM, normalización y buen CHM;
- Segmentación de copas óptima para el área;

```{r out.width='100%',  fig.height=3, eval=require('leaflet'), echo=F,eval=F}
library(leaflet)
leaflet() %>% addTiles() 
```

---

# Aspectos críticos
- **Tiempo de procesamiento**
- Clasificación de puntos
- Generación de un buen DTM, normalización y buen CHM
- Segmentación de copas óptima para el área

.pull-left[
```{r ex1,eval=F}
las<-readLAS('02_LiDAR/01_Muestra/648_5830_3.laz’)
46.86 segundos#<<
```
]
.pull-right[
```{r ex2,eval=F}
las<-readLAScatalog('02_LiDAR/01_Muestra/648_5830_3.laz’)
3.48 segundos#<<
```
]


--
- La función *readLAScatalog()* permite el procesamiento de un archivo completo o de un conjunto de archivos considerando parámetros fijados por el usuario.

--
- Optimiza el proceso de lectura y permite el trabajo multinúcleo.

--
- Se pueden aplicar las funciones a todos los archivos considerando procesamiento wall-to-wall asegurando ajuste entre los archivbos y chunks procesados

---


background-image: url(las_cloud1.png)
background-position: center
background-size:contain


---

# Diapo con viñetas

algo algo

- primero;

- segundo;

- tercero;





.footnote[[*] It is different with Pandoc's Markdown! It is limited but should be enough for presentation purposes. Come on... You do not need a slide for the Table of Contents! Well, the Markdown support in remark.js [may be improved](https://github.com/gnab/remark/issues/142) in the future.]



---
class: inverse, middle, center

# separador


---

# R Code

```{r comment='#'}
# a boring regression
fit = lm(dist ~ 1 + speed, data = cars)
coef(summary(fit))
dojutsu = c('地爆天星', '天照', '加具土命', '神威', '須佐能乎', '無限月読')
grep('天', dojutsu, value = TRUE)
```

---

# R Plots

```{r cars, fig.height=4, dev='svg'}
par(mar = c(4, 4, 1, .1))
plot(cars, pch = 19, col = 'darkgray', las = 1)
abline(fit, lwd = 2)
```

---

# Tables

If you want to generate a table, make sure it is in the HTML format (instead of Markdown or other formats), e.g.,

```{r}
knitr::kable(head(iris), format = 'html')
```

---

# HTML Widgets

<<<<<<< HEAD
=======
I have not thoroughly tested HTML widgets against **xaringan**. Some may work well, and some may not. It is a little tricky.


>>>>>>> 54fbd28dba339d8d7ee86daa6da7dc8f6ab5824a

See the next page for two HTML widgets.

---

```{r out.width='100%', fig.height=6, eval=require('leaflet')}
library(leaflet)
leaflet() %>% addTiles() %>% setView(-93.65, 42.0285, zoom =17)
```

---

```{r eval=require('DT'), tidy=FALSE}
DT::datatable(
  head(iris, 10),
  fillContainer = FALSE, options = list(pageLength = 8)
)
```




---
Resaltando código usando **#<<**

```{r tidy=FALSE, eval=FALSE}
library(ggplot2)
ggplot(mtcars) + 
  aes(mpg, disp) + 
  geom_point() +   #<<
  geom_smooth()    #<<
```

---

# Some Tips

When you enable line-highlighting, you can also use the chunk option `highlight.output` to highlight specific lines of the text output from a code chunk. For example, `highlight.output = TRUE` means highlighting all lines, and `highlight.output = c(1, 3)` means highlighting the first and third line.


```{r, highlight.output=c(1, 3), echo=FALSE}
head(iris)
```

Question: what does `highlight.output = c(TRUE, FALSE)` mean? (Hint: think about R's recycling of vectors)


---

class: center, middle

# Thanks!

Slides created via the R package [**xaringan**](https://github.com/yihui/xaringan).

The chakra comes from [remark.js](https://remarkjs.com), [**knitr**](http://yihui.org/knitr), and [R Markdown](https://rmarkdown.rstudio.com).
